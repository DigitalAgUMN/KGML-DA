# KGML-DA
A knowledge-guided data assimilation framework for agroecosystem modeling https://doi.org/10.1016/j.rse.2023.113880

# Demo data
The demo data can be downloaded here https://drive.google.com/file/d/1PrqTvpnCqTy6kup4KsGe6T7uzbVYG7Tf/view?usp=sharing
The trained model is named "demo_model_cornBelt20299_state_dict.pth"

# Surrogate training
Run KGDA_batchTrain.py

# Site experiments for KGML-DA
Run KGDA_site_experiment.py

# PSO parameter calibration
Run KGDA_PSO_parameter_calibration.py

# Dataset descriptions
https://drive.google.com/drive/folders/1PxaAyVTbwsh2MDh_3LmDXm4aavhxhAU4?usp=drive_link
1. Processed datasets:
1.1 level-2 data
output_cornBelt20299_pkl_all_separate:
Point-level synthetic dataset of input and output of the Ecosys simulations. This is the dataset to train the KGML-DA.

inputMerged_DA_countyMerge:
County-level yearly input. Size: 21 year * 356(or 366) days * 23 variables. The climate variables and soil properties were aggregated into the county level. Produced by script "PREPROCESS_pixel_level_simulation_extract_cropland_points.py", and "PREPROCESS_aggregate_points_to_county_level.py". This dataset is the input for the inference of KGML-DA.

GPP:
Aggregated county-level 250m SLOPE GPP. This data is generated by Wang Zhou, please ask him for details. This is the observation for DA.

GLASS_LAI_v2:
Aggregated county-level 250m GLASS LAI. Produced by the script "PREPROCESS_extract_GLASS_LAI_MODIS_ET_yearly.py". This is the observation for DA.

MODIS_ET_v2:
Aggregated county-level 500m MODIS ET. Produced by the script "PREPROCESS_extract_GLASS_LAI_MODIS_ET_yearly.py". This is the observation for DA.
1.2 level-1 data
samplePoints:
Time-invariant sampling points for each county. This data is used to extract the NLDAS2 weather data, which will be used by “PREPROCESS_WEATHER_extractNLDASbyPoints_v3.py”

CDL_points_yearly and site_info_yearly
Sampling points that are resampled each year based on the CDL. This data is used to extract GLASS LAI and MODIS ET.

CDL_points_yearly_Champaign
CDL information of every pixels of Champaign county. You’ll need this to reproduce Fig. 11.

CDL_cornBelt_TIGER
County-level CDL from 2000-2020 cropped by TIGER: US Census Counties 2018
2. RAW data:
SLOPE_GPP_Champaign_17019
30 m SLOPE GPP for Champaign County. You will need this to reproduce Fig.11

DaymetV4_Champaign:
You will need this to reproduce Fig.11

CDSL2000-2007
30 raster for the entire corn belt

CDL2008-2022
30 raster for the entire corn belt

Yield:
NASS yields for corn belt from 2000-2020.


